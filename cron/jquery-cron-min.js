(function(e){var n={initial:"* * * * *",url_set:undefined,onChange:undefined};var x="";for(var t=0;t<60;t++){var s=(t<10)?"0":"";x+="<option value='"+t+"'>"+s+t+"</option>\n"}var d="";for(var t=0;t<24;t++){var s=(t<10)?"0":"";d+="<option value='"+t+"'>"+s+t+"</option>\n"}var u="";for(var t=1;t<32;t++){if(t==1||t==21){var c="st"}else{if(t==2||t==22){var c="nd"}else{if(t==3||t==23){var c="rd"}else{var c="th"}}}u+="<option value='"+t+"'>"+t+c+"</option>\n"}var h="";var l=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var t=0;t<l.length;t++){h+="<option value='"+(t+1)+"'>"+l[t]+"</option>\n"}var r="";var g=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(var t=0;t<g.length;t++){r+="<option value='"+t+"'>"+g[t]+"</option>\n"}var q="";var b=["minute","hour","day","week","month","year"];for(var t=0;t<b.length;t++){q+="<option value='"+b[t]+"'>"+b[t]+"</option>\n"}var p={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]};var v={minute:/^(\*\s){4}\*$/,hour:/^\d{1,2}\s(\*\s){3}\*$/,day:/^(\d{1,2}\s){2}(\*\s){2}\*$/,week:/^(\d{1,2}\s){2}(\*\s){2}\d{1,2}$/,month:/^(\d{1,2}\s){3}\*\s\*$/,year:/^(\d{1,2}\s){4}\*$/};function a(i){if(typeof i=="undefined"){return false}else{return true}}function y(F){var D=/^((\d{1,2}|\*)\s){4}(\d{1,2}|\*)$/;if(typeof F!="string"||!D.test(F)){e.error("cron: invalid initial value");return undefined}var E=F.split(" ");var C=[0,0,1,1,0];var z=[59,23,31,12,6];for(var B=0;B<E.length;B++){if(E[B]=="*"){continue}var j=parseInt(E[B]);if(a(j)&&j<=z[B]&&j>=C[B]){continue}e.error("cron: invalid value found (col "+(B+1)+") in "+o.initial);return undefined}for(var A in v){if(v[A].test(F)){return A}}e.error("cron: valid but unsupported cron format. sorry.");return undefined}function f(j,i){if(!a(y(i.initial))){return true}return false}function k(z){var i=z.data("block");var j=hour=day=month=dow="*";switch(i.period.find("select").val()){case"hour":j=i.mins.find("select").val();break;case"day":j=i.time.find("select.cron-time-min").val();hour=i.time.find("select.cron-time-hour").val();break;case"week":j=i.time.find("select.cron-time-min").val();hour=i.time.find("select.cron-time-hour").val();dow=i.dow.find("select").val();break;case"month":j=i.time.find("select.cron-time-min").val();hour=i.time.find("select.cron-time-hour").val();day=i.dom.find("select").val();break;case"year":j=i.time.find("select.cron-time-min").val();hour=i.time.find("select.cron-time-hour").val();day=i.dom.find("select").val();month=i.month.find("select").val();break}return[j,hour,day,month,dow].join(" ")}var w={init:function(i){var z=e.extend([],n,i);if(f(this,z)){return this}var j=[];j.period=e("<span class='cron-period'>Every <select name='cron-period'>"+q+"</select> </span>").appendTo(this).find("select").bind("change.cron",m.periodChanged).data("root",this).gentleSelect().end();j.dom=e("<span class='cron-block cron-block-dom'> on the <select name='cron-dom'>"+u+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect({rows:10,itemWidth:30,title:"Day of Month"}).data("root",this).end();j.month=e("<span class='cron-block cron-block-month'> of <select name='cron-month'>"+h+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect({columns:2,itemWidth:100}).data("root",this).end();j.mins=e("<span class='cron-block cron-block-mins'> at <select name='cron-mins'>"+x+"</select> minutes past the hour </span>").appendTo(this).data("root",this).find("select").gentleSelect({columns:4,itemWidth:30,title:"Minutes Past the Hour"}).data("root",this).end();j.dow=e("<span class='cron-block cron-block-dow'> on <select name='cron-dow'>"+r+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect().data("root",this).end();j.time=e("<span class='cron-block cron-block-time'> at <select name='cron-time-hour' class='cron-time-hour'>"+d+"</select>:<select name='cron-time-min' class='cron-time-min'>"+x+" </span>").appendTo(this).data("root",this).find("select.cron-time-hour").gentleSelect({columns:2,itemWidth:20,title:"Time: Hour"}).data("root",this).end().find("select.cron-time-min").gentleSelect({columns:4,itemWidth:20,title:"Time: Minute"}).data("root",this).end();j.controls=e("<span class='cron-controls'>&laquo; save <span class='cron-button cron-button-save'></span> </span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",m.saveClicked).data("root",this).end();this.find("select").bind("change.cron-callback",m.somethingChanged);this.data("options",z).data("block",j);this.data("current_value",z.initial);return w.value.call(this,z.initial)},value:function(E){if(!E){return k(this)}var B=y(E);if(!a(B)){return false}var D=this.data("block");var C=E.split(" ");var z={mins:C[0],hour:C[1],dom:C[2],month:C[3],dow:C[4],};var j=p[B];for(var A=0;A<j.length;A++){var F=j[A];if(F=="time"){D[F].find("select.cron-time-hour").val(z.hour).gentleSelect("update").end().find("select.cron-time-min").val(z.mins).gentleSelect("update").end()}else{D[F].find("select").val(z[F]).gentleSelect("update")}}D.period.find("select").val(B).gentleSelect("update").trigger("change");return this}};var m={periodChanged:function(){var z=e(this).data("root");var B=z.data("block");var j=p[e(this).val()];z.find("span.cron-block").hide();for(var A=0;A<j.length;A++){B[j[A]].show()}},somethingChanged:function(){root=e(this).data("root");if(a(root.data("options").url_set)){if(w.value.call(root)!=root.data("current_value")){root.addClass("cron-changed");root.data("block")["controls"].fadeIn()}else{root.removeClass("cron-changed");root.data("block")["controls"].fadeOut()}}else{root.data("block")["controls"].hide()}var i=root.data("options").onChange;if(a(i)&&e.isFunction(i)){i.call(root)}},saveClicked:function(){var j=e(this);var i=j.data("root");var z=w.value.call(i);if(j.hasClass("cron-loading")){return}j.addClass("cron-loading");e.ajax({type:"POST",url:i.data("options").url_set,data:{cron:z},success:function(){i.data("current_value",z);j.removeClass("cron-loading");if(z==w.value.call(i)){i.removeClass("cron-changed");i.data("block").controls.fadeOut()}},error:function(){alert("An error occured when submitting your request. Try again?");j.removeClass("cron-loading")},})}};e.fn.cron=function(i){if(w[i]){return w[i].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof i==="object"||!i){return w.init.apply(this,arguments)}else{e.error("Method "+i+" does not exist on jQuery.cron")}}}})(jQuery);